name: Campus Food Court CI/CD Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-and-build:
    name: Test and Build
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install backend dependencies
      run: |
        cd backend
        npm install
      
    - name: Run backend tests
      run: |
        cd backend
        npm test
    
    - name: Verify Docker configuration
      run: |
        if [ -f docker-compose.yml ]; then
          echo "âœ… Docker Compose configuration found"
          docker-compose config
        else
          echo "âš ï¸ Docker Compose not found"
        fi
    
    - name: Build success notification
      run: |
        echo "âœ… Build completed successfully!"
        echo "Project: Campus Food Court"
        echo "Branch: ${{ github.ref }}"
        echo "Commit: ${{ github.sha }}"
        echo "Author: ${{ github.actor }}"

  code-quality:
    name: Code Quality Check
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Check file structure
      run: |
        echo "ğŸ“ Checking project structure..."
        ls -R
    
    - name: Verify required files
      run: |
        echo "Checking backend files..."
        test -f backend/package.json && echo "âœ… package.json found"
        test -f backend/server.js && echo "âœ… server.js found"
        test -f backend/.env.example && echo "âœ… .env.example found" || echo "âš ï¸ .env.example missing"
        
        echo "Checking database files..."
        test -f database/init.sql && echo "âœ… Database schema found"
        
        echo "Checking Docker files..."
        test -f docker-compose.yml && echo "âœ… docker-compose.yml found"
        test -f backend/Dockerfile && echo "âœ… Backend Dockerfile found"

  deployment-ready:
    name: Deployment Readiness Check
    runs-on: ubuntu-latest
    needs: [test-and-build, code-quality]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Deployment status
      run: |
        echo "ğŸš€ Project is ready for deployment!"
        echo "âœ… All tests passed"
        echo "âœ… Code quality verified"
        echo "âœ… Ready for production"
        echo "ğŸ“¦ Deployment target: Multi-machine or AWS"